# 1.命名规范

Java代码的命名应该**清晰、简洁和易于理解**。我们代码评审的时候，要注意**是否有命名不规范，不清晰的代码**。下面是一些命名规范的建议：

- 类和接口应该使用首字母大写的驼峰命名法
- 方法和变量应该使用小写的驼峰命名法
- 常量应该使用全大写字母和下划线
- 开发者是不是选择易于理解的名称给变量、类和方法进行命名



# 2.添加必要的注释

- 所有的类都必须添加创建者和创建日期，以及简单的注释描述
- 方法内部的复杂业务逻辑或者算法，需要添加清楚的注释
- 一般情况下，注释描述类、方法、变量的作用
- 任何需要提醒的警告或`TODO`，也要注释清楚
- 如果是注释一行代码的，就用`//`;如果注释代码块或者接口方法的，有多行`/* **/`
- **一块代码逻辑如果你站在一个陌生人的角度去看,第一遍看不懂的话,就需要添加注释了**



# 3.日志打印规范

**这些日志规范没遵守，就需要修改**：

- 日志级别选择不对。常见的日志级别有`error、warn、info、debug`四种，不要反手就是`info`哈
- 日志没打印出**调用方法**的入参和响应结果，尤其是跨系统调用的时候。
- 业务日志没包含关键参数,如`userId,bizSeq`等等,不方便问题排查
- 如果日志包含关键信息，比如手机号、身份证等，需要**脱敏处理**
- 一些不符合预期的情况，如一些未知异常（数据库的数据异常等），又或者**不符合业务预期的特殊场景，都需要打印相关的日志**

对于**日志打印**规范，可以参考 [工作总结！日志打印的15个建议](https://mp.weixin.qq.com/s?__biz=Mzg3NzU5NTIwNg==&mid=2247494838&idx=1&sn=cdb15fd346bddf3f8c1c99f0efbd67d8&chksm=cf22339ff855ba891616c79d4f4855e228e34a9fb45088d7acbe421ad511b8d090a90f5b019f&token=162724582&lang=zh_CN&scene=21#wechat_redirect)



# 4.参数校验

我们代码评审的时候，要注意参数是否都做了校验，如`userId`非空检查、金额范围检查、`userName`长度校验等等。一般我们在处理业务逻辑的时候，要遵循`先检查、后处理`的原则。

> 如果你的数据库字段userName设置为`varchar(16)`,对方传了一个`32`位的字符串过来，你不校验参数，**插入数据库直接异常**了。

很多bug都是因为**没做参数校验**造成的，这一军规，**是代码评审重点关注的哈**



# 5.判空处理

- 获取对象的属性时，都要判空处理。要不然很多时候会出现空指针异常。

```java

if(object!=null){
   String name = object.getName();
}
```

如果你要遍历列表，也需要判空

```java

  if (CollectionUtils.isNotEmpty(tianLuolist)) {
        for (TianLuo temp : tianLuolist) {
            //do something
        }
    }
```



# 6.异常规范处理

良好的异常处理可以确保代码的可靠性和可维护性。因此，异常处理也是代码评审的一项重要规范。以下是一些异常处理的建议：

- 不要捕获通用的`Exception`异常，而应该尽可能捕获特定的异常
- 在捕获异常时，应该记录异常信息以便于调试
- 内部异常要确认最终的处理方式，**避免未知异常当作失败处理**。
- 在`finally`块中释放资源，或者使用`try-with-resource`
- 不要使用`e.printStackTrace()`,而是使用`log`打印。
- `catch`了异常，要打印出具体的`exception`，否则无法更好定位问题
- 捕获异常与抛出异常必须是完全匹配，或者捕获异常是抛异常的父类
- 捕获到的异常，不能忽略它，要打印相对应的日志
- 注意异常对你的代码层次结构的侵染（早发现早处理）
- 自定义封装异常，不要丢弃原始异常的信息`Throwable cause`
- 注意异常匹配的顺序，优先捕获具体的异常
- 对外提供APi时，要提供对应的错误码
- 系统内部应该抛出有业务含义的自定义异常，而不是直接抛出`RuntimeException`，或者直接抛出`Exception\Throwable`。

异常处理可以参考 [Java 异常处理的十个建议](https://mp.weixin.qq.com/s?__biz=Mzg3NzU5NTIwNg==&mid=2247488009&idx=1&sn=7c27849c67476143660e3ea0dcdfae3d&chksm=cf21cd20f8564436b016bfcb78736927e5f76852f194e746d7604dcd74e420bcbcc999c8f639&token=606989984&lang=zh_CN#rd)



# 7.单元测试规范

- 测试类的命名,一般以测试的类+`Test`,如:`CalculatorTest`.
- 测试方法的命名,一般以`test`开头+ 测试的方法,如`testAdd`.
- 单测行覆盖率一般要求大于`75%`.
- 单测一般要求包含主流程用例、参数边界值等校验用例
- 单测一般也要求包含中间件访问超时、返回空、等异常的用例,比如访问数据库或者`Redis`异常.
- 单测用例要求包含**并发、防重、幂等**等用例.



# 8.代码格式规范

良好的代码格式，可以使代码更**容易阅读和理解**。下面是一些常见的代码格式化建议：

- 缩进使用四个空格
- 代码块使用花括号分隔
- 每行不超过`80`个字符
- 每个方法应该按照特定的顺序排列，例如：`类变量、实例变量、构造函数、公共方法、私有方法`等。



# 9.模块化，可扩展性

**代码编写设计是否满足模块化，接口是否具有可扩展性**

可以使用设计模式（策略模式、模板方法模式）提高可扩展性。



# 10.程序逻辑清晰，主次分明

代码评审的时候，要关注程序逻辑是否清晰。比如，你的一个注册接口，**有参数校验、判断用户是否已经注册、插入用户记录、发送注册成功通知等功能**。如果你把所有所有功能代码塞到一个方法里面，程序逻辑就不清晰，**主次不够分明**。

可以将参数校验的代码单独抽取到一个方法。



# 11.安全规范

代码评审，也非常有必要**评审代码是否存在安全性问题**。比如：

- **输入校验**：应该始终对任何来自外部的输入数据进行校验，以确保它们符合预期并且不会对系统造成伤害。校验应该包括检查数据的类型、大小和格式。
- **防范SQL注入攻击**:在使用SQL查询时，应该始终使用参数化查询或预处理语句，以防止SQL注入攻击。
- **防范跨站脚本攻击（XSS）**: 在Web应用程序中，应该始终对输入的HTML、JavaScript和CSS进行校验，并转义特殊字符，以防止XSS攻击。
- **避免敏感信息泄露**: 敏感信息（如密码、密钥、会话ID等）应该在传输和存储时进行加密，以防止被未经授权的人访问。同时，应该避免在日志、调试信息或错误消息中泄露敏感信息。
- **防范跨站请求伪造（CSRF）**: 应该为所有敏感操作（如更改密码、删除数据等）添加`CSRF`令牌，以防止未经授权的人员执行这些操作。
- **防范安全漏洞**: 应该使用安全性高的算法和协议（如HTTPS、TLS）来保护敏感数据的传输和存储，并定期对系统进行漏洞扫描和安全性审计

保证数据安全的方案参考 [保证接口数据安全的10种方案](https://mp.weixin.qq.com/s?__biz=Mzg3NzU5NTIwNg==&mid=2247500285&idx=1&sn=7d0723f25d46e858859cfd79acb6fb9d&chksm=cf221ed4f85597c2093f81baa5fdedc65817bf2d23a7951236836b0f54c2335695cbed61cd13&token=551155291&lang=zh_CN#rd)



# 12.事务控制规范

- 一般推荐使用编程式事务，而不是一个注解 `@Transactional`的声明式事务。因为 `@Transactional`有很多场景，可能导致事务不生效。  
- 事务范围要明确，数据库操作必须在事务作用范围内，**如果是非数据库操作，尽量不要包含在事务内。**
- 不要在事务内进行远程调用（可能导致数据不一致，比如本地成功了，但是远程方法失败了，这时候需要用分布式事务解决方案）
- 事务中避免处理太多数据，一些查询相关的操作，尽量放到事务之外（避免大事务问题）





# 13.重复代码处理

大量重复代码（抽公用方法，设计模式）

具体可以参考：[优化重复冗余代码的8种方式 - 掘金](https://juejin.cn/post/7270026656663322685)



# 14.操作数据库、缓存、中间件、外部接口的代码单独抽取一个类





# 15.使用String.format进行字符串格式化



字符串格式化使用`String.format()`。用法参考：[string.format()详解 - 双间 - 博客园](https://www.cnblogs.com/mark5/p/11430245.html)



# 16.避免“炫技式”的单行代码



“炫技式”的单行代码难以理解、排查和修改起来都麻烦且耗时。

[一个较重的代码坏味：“炫技式”的单行代码 - 琴水玉 - 博客园](https://www.cnblogs.com/lovesqcc/p/16559923.html)





# reference

- [代码评审的18个军规，收藏好！ - 掘金](https://juejin.cn/post/7228977496515379258)

